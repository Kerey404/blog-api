<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login / Sign Up - QuizMaster</title>
    <link rel="stylesheet" href="/css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
</head>
<body>
<div class="container">
    <div style="max-width: 500px; margin: 60px auto;">
        <div class="card">
            <div class="text-center mb-4">
                <h1 style="font-size: 2.5rem; margin-bottom: 8px;">üéØ QuizMaster</h1>
                <p class="text-muted">Join the ultimate quiz platform!</p>
            </div>

            <div id="alertMessage" class="hidden"></div>

            <div class="btn-group mb-4">
                <button class="btn btn-primary" id="loginTabBtn" onclick="switchTab('login')">Login</button>
                <button class="btn btn-outline" id="registerTabBtn" onclick="switchTab('register')">Sign Up</button>
            </div>

            <form id="loginForm" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label class="form-label">Email Address</label>
                    <input type="email" class="form-control" id="loginEmail" placeholder="your@email.com" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-control" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                </div>
                <button type="submit" class="btn btn-primary btn-block btn-lg" id="loginBtn">
                    Login
                </button>
            </form>

            <form id="registerForm" class="hidden" onsubmit="handleRegister(event)">
                <div class="form-group">
                    <label class="form-label">Username</label>
                    <input type="text" class="form-control" id="registerUsername" placeholder="cooluser123" minlength="3" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Email Address</label>
                    <input type="email" class="form-control" id="registerEmail" placeholder="your@email.com" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Password (min 6 characters)</label>
                    <input type="password" class="form-control" id="registerPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" minlength="6" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Choose Your Avatar</label>
                    <div class="grid grid-3">
                        <label class="option-btn" style="cursor: pointer;">
                            <input type="radio" name="avatar" value="üéÆ" checked style="display: none;">
                            <span class="option-letter">üéÆ</span>
                            <span>Gamer</span>
                        </label>
                        <label class="option-btn" style="cursor: pointer;">
                            <input type="radio" name="avatar" value="üß†" style="display: none;">
                            <span class="option-letter">üß†</span>
                            <span>Brain</span>
                        </label>
                        <label class="option-btn" style="cursor: pointer;">
                            <input type="radio" name="avatar" value="üöÄ" style="display: none;">
                            <span class="option-letter">üöÄ</span>
                            <span>Rocket</span>
                        </label>
                        <label class="option-btn" style="cursor: pointer;">
                            <input type="radio" name="avatar" value="‚≠ê" style="display: none;">
                            <span class="option-letter">‚≠ê</span>
                            <span>Star</span>
                        </label>
                        <label class="option-btn" style="cursor: pointer;">
                            <input type="radio" name="avatar" value="ü¶Ñ" style="display: none;">
                            <span class="option-letter">ü¶Ñ</span>
                            <span>Unicorn</span>
                        </label>
                        <label class="option-btn" style="cursor: pointer;">
                            <input type="radio" name="avatar" value="üé®" style="display: none;">
                            <span class="option-letter">üé®</span>
                            <span>Artist</span>
                        </label>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary btn-block btn-lg" id="registerBtn">
                    Create Account
                </button>
            </form>

            <div class="text-center mt-3">
                <a href="/" class="text-primary">‚Üê Back to Home</a>
            </div>
        </div>
    </div>
</div>

<script>
    const API_URL = '/api';

    function switchTab(tab) {
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const loginTabBtn = document.getElementById('loginTabBtn');
        const registerTabBtn = document.getElementById('registerTabBtn');

        if (tab === 'login') {
            loginForm.classList.remove('hidden');
            registerForm.classList.add('hidden');
            loginTabBtn.className = 'btn btn-primary';
            registerTabBtn.className = 'btn btn-outline';
        } else {
            loginForm.classList.add('hidden');
            registerForm.classList.remove('hidden');
            loginTabBtn.className = 'btn btn-outline';
            registerTabBtn.className = 'btn btn-primary';
        }
        hideAlert();
    }

    async function handleLogin(event) {
        event.preventDefault();

        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPassword').value;
        const btn = document.getElementById('loginBtn');

        btn.disabled = true;
        btn.textContent = 'Logging in...';

        try {
            const response = await fetch(`${API_URL}/auth/login`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ email, password })
            });

            const data = await response.json();

            if (data.success) {
                localStorage.setItem('token', data.token);
                localStorage.setItem('user', JSON.stringify(data.user));
                showAlert('‚úÖ Login successful! Redirecting...', 'success');

                setTimeout(() => {
                    window.location.href = '/dashboard.html';
                }, 1000);
            } else {
                showAlert('‚ùå ' + data.message, 'error');
            }
        } catch (error) {
            console.error('Login error:', error);
            showAlert('‚ùå Server error. Please try again.', 'error');
        } finally {
            btn.disabled = false;
            btn.textContent = 'Login';
        }
    }

    async function handleRegister(event) {
        event.preventDefault();

        const username = document.getElementById('registerUsername').value;
        const email = document.getElementById('registerEmail').value;
        const password = document.getElementById('registerPassword').value;
        const avatar = document.querySelector('input[name="avatar"]:checked').value;
        const btn = document.getElementById('registerBtn');

        btn.disabled = true;
        btn.textContent = 'Creating account...';

        try {
            const response = await fetch(`${API_URL}/auth/register`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ username, email, password, avatar })
            });

            const data = await response.json();

            if (data.success) {
                localStorage.setItem('token', data.token);
                localStorage.setItem('user', JSON.stringify(data.user));
                showAlert('‚úÖ Account created successfully! Redirecting...', 'success');

                setTimeout(() => {
                    window.location.href = '/dashboard.html';
                }, 1000);
            } else {
                showAlert('‚ùå ' + data.message, 'error');
            }
        } catch (error) {
            console.error('Register error:', error);
            showAlert('‚ùå Server error. Please try again.', 'error');
        } finally {
            btn.disabled = false;
            btn.textContent = 'Create Account';
        }
    }

    function showAlert(message, type) {
        const alert = document.getElementById('alertMessage');
        alert.className = `alert alert-${type}`;
        alert.textContent = message;
        alert.classList.remove('hidden');
    }

    function hideAlert() {
        document.getElementById('alertMessage').classList.add('hidden');
    }

    window.addEventListener('load', () => {
        const token = localStorage.getItem('token');
        if (token) {
            window.location.href = '/dashboard.html';
        }
    });

    document.querySelectorAll('input[name="avatar"]').forEach(radio => {
        radio.addEventListener('change', function() {
            document.querySelectorAll('label.option-btn').forEach(label => {
                label.classList.remove('selected');
            });
            this.closest('label').classList.add('selected');
        });
    });

    document.querySelector('input[name="avatar"]').closest('label').classList.add('selected');
</script>
</body>
</html>